{{> layout/header }}
<style>
    .payment-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    .payment-table th, .payment-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
    }

    .payment-table thead th {
        background-color: #007BFF;
        color: white;
        font-weight: bold;
    }

    .payment-table tr:nth-child(even) {
        background-color: #f2f2f2;
    }

    .payment-table tr:hover {
        background-color: #ddd;
    }

    .payment-table .text-center {
        text-align: center;
        color: #777;
        font-style: italic;
    }


</style>
<div class="container">
    <!-- 사이드바 - 프리랜서 전용 메뉴 -->
    {{> layout/mypage}}
        <!-- 메인 컨텐츠 -->
        <table class="payment-table">
            <thead>
            <tr>
                <th>주문 내역</th>
                <th>금액</th>
                <th>결제 방법</th>
                <th>요청 시간</th>
                <th>환불 요청</th>
            </tr>
            </thead>
            <tbody>
            {{#paymentList}}
                <tr>
                    <td>{{orderName}}</td>
                    <td>{{amount}}</td>
                    <td>{{method}}</td>
                    <td>{{requestedAt}}</td>
                    <td><span id="refund--Btn" data-status="{{status}}"><a href="javascript:void(0)"
                                                                           onclick="requestRefund({{id}})"
                                                                           class="btn btn-primary">환불 신청</a></span>
                </tr>
            {{/paymentList}}
            {{^paymentList}}
                <tr>
                    <td colspan="4" class="text-center">결제내역이 없습니다</td>
                </tr>
            {{/paymentList}}
            </tbody>
        </table>
    </div>
<script>
    // 페이지 로드 시 실행되는 코드
    window.onload = function() {
        const refundBtns = document.querySelectorAll('#refund--Btn'); // 모든 refund--Btn 요소를 선택

        refundBtns.forEach(refundBtn => {
            const status = refundBtn.getAttribute('data-status');

            // status 값이 1이면 텍스트를 '환불 신청중'으로 변경하고 클릭 비활성화
            if (status === '1') {
                const anchor = refundBtn.querySelector('a');
                anchor.textContent = '환불 처리중';
                anchor.style.pointerEvents = 'none'; // 클릭 이벤트 비활성화
                anchor.classList.add('disabled'); // 비활성화 스타일 추가 (선택 사항)
            } else if (status === '2'){
                const anchor = refundBtn.querySelector('a');
                anchor.textContent = '처리 완료';
                anchor.style.pointerEvents = 'none'; // 클릭 이벤트 비활성화
                anchor.classList.add('disabled'); // 비활성화 스타일 추가 (선택 사항)
            }
        });
    };
    function requestRefund(id) {


    if (confirm("정말 환불신청을 하시겠습니까?")) {

        fetch(`http://localhost:8080/user/fetchRefundStatus?id=` + id)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log("완료");
                location.reload();
            })
            .catch(error => {
                console.error('Error fetching:', error);
            });
    } else {
        console.log("사용자가 환불신청을 취소했습니다.");
    }
    }


</script>
{{> layout/footer }}
