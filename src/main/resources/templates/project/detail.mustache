{{>layout/header}}
<style type="text/css">
    .wait-form{
        display: none;
        background: white;
        border: none;
        border-radius: 5px;
        padding: 10px;
    }
    .wait-detail{
        margin: 10px;
        padding: 30px;
        display: flex;
        flex-direction: column;
        position: relative;
    }
    .project-box{
        width: 90%;
    }
    .project-input-form{
        margin: 5px;
    }
</style>
    <div class="project-detail">
        <img src="/images/logos/sample-img-bigger.png" style="cursor:pointer; width: 800px; height: 250px; border-radius: 15px;">
        {{#project}}
            <div id="each-project" style="location.href='/project/detail/{{id}}'">
                <p><b>{{company}}</b></p>
                <h4><b>{{projectName}}</b></h4>
                <div>
                    {{#project.skill}}
                        <div>{{skill}}</div>
                    {{/project.skill}}
                </div>
                <hr>
                <div class="detail-box">
                    <p>프로젝트 시작일: {{projectStart}} 예상 기간: {{period}}</p>
                    <p>지급 방식 : {{workingStyle}}</p>
                    <p>근무 방식 : {{workingStyle}}</p>
                    <p>미팅 방식 : {{meeting}}</p>
                    <p>작성일 : {{createdAt}}</p>
                </div>
                <hr>
                <div>
                    <div>
                        <h6>주요 업무</h6>
                        <p>{{mainTasks}}</p>
                    </div>
                    <div>
                        <h6>세부 사항</h6>
                        <p>{{detailTask}}</p>
                    </div>
                    <div>
                        <h6>전달 사항</h6>
                        <p>{{delivered}}</p>
                    </div>
                    <div>
                        <h6>담당자 정보</h6>
                        <p>담당자 : {{managerName}}</p>
                        <p>연락처 : {{contact}}</p>
                        <p>이메일 : {{email}}</p>
                    </div>
                </div>
                <div>
                    <div>
                        <h6>태그</h6>
                        <div>
                            {{#project.skill}}
                                <div>{{skill}}</div>
                            {{/project.skill}}
                        </div>
                    </div>
                    <div>
                        <h6>작성일</h6>
                        <p>{{createdAt}}</p>
                    </div>
                </div>
            </div>
        {{/project}}


        <div>
            <button id="chatRequestButton" class="btn btn-primary">1:1 채팅하기</button>
            <button class="btn btn-secondary" onclick="location.href='/project/list/1'">목록으로 돌아가기</button>
        </div>

    </div>


<script>
    document.getElementById('chatRequestButton').addEventListener('click', function(){
        const sessionId = "{{#session.id}}{{session.id}}{{/session.id}}{{^session.id}}null{{/session.id}}"; // 현재 로그인 된 사용자 ID
        const companyId = "{{project.id}}";     // 기업 ID

        if (sessionId === "null") {
            // sessionId가 없다면 로그인 필요 메시지 표시
            alert("로그인 후 신청가능합니다.");
            return; // 함수 종료
        }

        const confirmation = confirm("채팅 신청을 보내시겠습니까?");
        if (confirmation) {
            fetch(`/match/chat-request?senderId=${sessionId}&receiverId=${companyId}`, {
                method: 'POST', 
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.text() ) // 서버로부터 성공 응답 받기
            .then(message => {
                alert(message);
                window.location.href = '/main';
            });
        }
    });

</script>
{{>layout/footer}}
