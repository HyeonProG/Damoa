{{>layout/header}}
<style type="text/css">
    .project-detail{
        margin-bottom: 60px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
    .wait-form{
        display: none;
        background: white;
        border: none;
        border-radius: 5px;
        padding: 10px;
    }
    .wait-detail{
        margin: 10px;
        padding: 30px;
        display: flex;
        flex-direction: column;
        position: relative;
    }
    .project-box{
        width: 90%;
    }
    .project-input-form{
        margin: 5px;
    }
    .main-title-box{
        display: flex;
        flex-direction: column;
        align-items: flex-start; /* 왼쪽 정렬 */
    }
    .each-project{
        width:80%;
        display: flex;
        justify-content: center;
        align-items: center;
    }
</style>
    <div class="project-detail">
        <div style="position: relative; width: 1100px;">
            <img src="/images/logos/sample-img-bigger.png" style="cursor:pointer; width: 1050px; border-radius: 15px;">
            <img src="/images/logos/annonymus_com.png" style="position: absolute; top: 100%; left: 14%; height: 150px; transform: translate(-50%, -50%);">
        </div>
        {{#project}}
            <div id="each-project" style="margin-top:60px; display: flex; width: 95%;">
                    <div class="explanation" style="margin-left:70px;">
                    <div class="main-title-box" style="height: 40px; margin-top: 40px; margin-bottom:70px;">
                        <h3 style="margin-bottom: 10px; text-align: left;"><b>{{projectName}}</b></h3>
                        <p style="margin-bottom: 30px;">{{company}}</p>
                    </div>

                    <div   style="margin-top:40px; display: flex; width: 90%; display: flex;">
                        {{#skill}}
                            <div style="padding: 10px; border-radius: 10px; display: flex; margin: 0px 5px; background: #f1f3f5;">
                                #{{.}} <!-- Outputs the current skill -->
                            </div>
                        {{/skill}}
                    </div>
                    <hr  style="margin-bottom: 15px;">
                    <div class="main-title-box" style="margin-top:40px; width: 90%; margin-bottom: 50px;">
                        <h4 style="margin-bottom: 20px;"><b>기본 정보</b></h4>
                        <p style="margin:5px 0px;"><b>프로젝트 시작일 : </b> {{projectStart}} 예상 기간: {{period}}</p>
                        <p style="margin:5px 0px;"><b>지급 방식 : </b> {{workingStyle}}</p>
                        <p style="margin:5px 0px;"><b>근무 방식 : </b> {{workingStyle}}</p>
                        <p style="margin:5px 0px;"><b>미팅 방식 : </b> {{meeting}}</p>
                        <p style="margin:5px 0px;"><b>작성일 : </b> {{createdAt}}</p>
                    </div>
                    <hr>
                    <div class="main-title-box" style="margin-top:40px; width: 90%; margin-bottom: 50px;">
                        <h5 style="margin-bottom: 20px; margin-left:0px;"><b>세부 사항</b></h5>
                        <div style="display: flex; flex-direction: column; align-items: flex-start; margin-bottom: 20px;">
                            <h6>주요 업무</h6>
                            <p>{{mainTasks}}</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: flex-start; margin-bottom: 20px;">
                            <h6>세부 사항</h6>
                            <p>{{detailTask}}</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: flex-start; margin-bottom: 20px;">
                            <h6>전달 사항</h6>
                            <p>{{delivered}}</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: flex-start; margin-bottom: 20px;">
                            <h6>담당자 정보</h6>
                            <p>담당자 : {{managerName}}</p>
                            <p>연락처 : {{contact}}</p>
                            <p>이메일 : {{email}}</p>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: flex-start; margin-bottom: 20px;">
                            <h6>작성일</h6>
                            <p>{{createdAt}}</p>
                        </div>
                    </div>
                </div>
                <div style="width:400px; margin-top: 40px;">
                    <button class="btn btn-primary" id="chatRequestButton" style="width: 250px; margin: 5px;" >1:1 채팅하기</button>
                    <button class="btn btn-secondary" style="width: 250px; margin: 5px;" onclick="location.href='/project/list/1'">목록으로 돌아가기</button>
                </div>
            </div>
        {{/project}}

    </div>


<script>
    document.getElementById('chatRequestButton').addEventListener('click', function(){
        const sessionId = "{{#session.id}}{{session.id}}{{/session.id}}{{^session.id}}null{{/session.id}}"; // 현재 로그인 된 사용자 ID
        const companyId = "{{project.id}}";     // 기업 ID

        if (sessionId === "null") {
            // sessionId가 없다면 로그인 필요 메시지 표시
            alert("로그인 후 신청가능합니다.");
            return; // 함수 종료
        }

        const confirmation = confirm("채팅 신청을 보내시겠습니까?");
        if (confirmation) {
            fetch(`/match/chat-request?senderId=${sessionId}&receiverId=${companyId}`, {
                method: 'POST', 
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.text() ) // 서버로부터 성공 응답 받기
            .then(message => {
                alert(message);
                window.location.href = '/main';
            });
        }
    });

</script>
{{>layout/footer}}
